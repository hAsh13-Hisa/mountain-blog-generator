# 低山旅行自動記事作成アプリ 要件定義書 v2.0

**プロジェクト名**: 低山旅行自動記事作成アプリ (Mountain Blog Generator)  
**バージョン**: 2.0  
**作成日**: 2025年6月10日  
**最終更新**: 2025年6月10日  

## 1. プロジェクト概要

### 1.1 目的
日本の低山登山に関する高品質なブログ記事を自動生成し、楽天アフィリエイトリンクを含めてWordPressサイトに自動投稿するシステムを構築する。

### 1.2 背景
- 山登り・ハイキング情報の需要増加
- SEO対策された記事の継続的な投稿の必要性
- アフィリエイト収益の自動化
- 記事作成にかかる時間とコストの削減

### 1.3 プロジェクトスコープ
- 低山（標高1000m以下中心）の登山記事作成
- 楽天アフィリエイト収益化
- WordPress自動投稿システム
- スケジュール投稿機能

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 記事自動生成機能 ✅
- **Claude AI API**を使用した高品質な記事生成
- 山の基本情報（標高、所在地、難易度）を含む構造化された記事
- SEO最適化されたタイトル・メタディスクリプション
- 季節・テーマに応じた記事バリエーション
- 文字数: 2000-3000文字程度

#### 2.1.2 アフィリエイトリンク自動挿入機能 ✅
- **楽天アフィリエイトAPI**を使用した商品情報取得
- 登山用品（ウェア、シューズ、バックパック等）の自動選定
- 宿泊施設情報の自動取得と挿入
- アフィリエイトリンクの適切な配置とフォーマット

#### 2.1.3 画像自動取得機能 ✅
- **Unsplash API**を使用した山・自然系画像の取得
- アイキャッチ画像の自動設定
- 記事内容に適した画像の選定
- 画像の代替テキスト自動生成

#### 2.1.4 WordPress自動投稿機能 ✅
- **WordPress XML エクスポート形式**での記事投稿
- カテゴリ・タグの自動設定
- SEOメタデータの設定
- **スケジュール投稿機能**（1時間間隔での自動公開）
- **Featured Image from URL**プラグイン対応

### 2.2 ユーザーインターフェース

#### 2.2.1 Web UI ✅
- **Flask**ベースのレスポンシブWebアプリケーション
- 山選択インターフェース
- 記事生成・プレビュー機能
- 一括記事生成機能
- 楽天アフィリエイトリンク表示確認

#### 2.2.2 操作フロー ✅
1. 山の選択（単体/複数/全件）
2. テーマ選択（初心者向け、家族向け、紅葉等）
3. 記事生成実行
4. プレビュー確認
5. WordPress XMLエクスポート
6. 手動インポートまたは自動投稿

### 2.3 データ管理機能

#### 2.3.1 山マスターデータ ✅
- 日本全国の低山情報データベース
- 基本情報：標高、所在地、難易度、アクセス情報
- JSON形式での管理
- 20山以上の詳細データ

#### 2.3.2 記事履歴管理 ✅
- 生成済み記事の履歴保存
- JSON形式での一括エクスポート
- 記事内容の再編集・再利用機能

## 3. 技術要件

### 3.1 開発環境
- **言語**: Python 3.12.3
- **フレームワーク**: Flask（Web UI）
- **アーキテクチャ**: Clean Architecture
- **環境**: WSL2 Ubuntu + venv

### 3.2 外部API・サービス

#### 3.2.1 Claude API ✅
- **プロバイダー**: Anthropic
- **モデル**: Claude-3.5-Sonnet
- **用途**: 高品質な記事生成
- **認証**: APIキー認証

#### 3.2.2 楽天API ✅
- **サービス**: 楽天アフィリエイトAPI
- **用途**: 商品情報取得、アフィリエイトリンク生成
- **認証**: アプリケーションID + アフィリエイトID

#### 3.2.3 Unsplash API ✅
- **用途**: 山・自然系画像の取得
- **形式**: REST API
- **画像サイズ**: 800x400px（アイキャッチ用）

#### 3.2.4 WordPress ✅
- **方式**: XML Import/Export形式
- **対象サイト**: https://teizan.abg.ooo
- **認証**: 管理画面での手動インポート
- **投稿者**: aime

### 3.3 技術スタック

#### 3.3.1 バックエンド ✅
- **Python**: 3.12.3
- **Web Framework**: Flask 2.3+
- **HTTP Client**: requests
- **設定管理**: pydantic-settings
- **ログ**: logging + colorlog

#### 3.3.2 フロントエンド ✅
- **HTML5/CSS3/JavaScript**
- **CSS Framework**: Bootstrap 5.3
- **UI Components**: レスポンシブデザイン
- **Ajax**: fetch API使用

#### 3.3.3 データフォーマット ✅
- **設定**: JSON形式
- **記事出力**: JSON + WordPress XML
- **ログ**: 構造化ログ（JSON）

## 4. 非機能要件

### 4.1 パフォーマンス ✅
- 1記事の生成時間: 30-60秒以内
- 10記事の一括生成: 10分以内
- Web UIの応答時間: 3秒以内

### 4.2 可用性 ✅
- API障害時の適切なエラーハンドリング
- 生成途中での中断・再開機能
- ログによる詳細な処理追跡

### 4.3 保守性 ✅
- Clean Architectureによる保守しやすい設計
- 設定の外部化（環境変数）
- 包括的なログ出力
- エラーハンドリングの統一

### 4.4 セキュリティ ✅
- APIキーの環境変数管理
- 秘密情報のログ出力防止
- 入力値の適切なバリデーション

## 5. システム構成

### 5.1 アーキテクチャ ✅
```
mountain_blog_generator/
├── config/                 # 設定管理
│   ├── settings.py        # 環境変数・設定
│   └── logging_config.py  # ログ設定
├── src/
│   ├── domain/            # ドメイン層
│   │   ├── entities/      # エンティティ
│   │   └── value_objects/ # 値オブジェクト
│   ├── application/       # アプリケーション層
│   │   └── services.py    # ビジネスロジック
│   ├── infrastructure/    # インフラ層
│   │   ├── repositories/  # データアクセス
│   │   └── external_apis/ # 外部API
│   └── presentation/      # プレゼンテーション層
│       ├── web/           # Flask Web UI
│       └── cli/           # CLI（未実装）
├── data/                  # マスターデータ
│   └── mountains.json     # 山情報
├── logs/                  # ログファイル
└── output/                # 生成結果
```

### 5.2 データフロー ✅
1. **入力**: 山選択 + テーマ選択
2. **処理**: Claude API → 記事生成
3. **拡張**: 楽天API → アフィリエイトリンク追加
4. **画像**: Unsplash → アイキャッチ画像取得
5. **出力**: WordPress XML形式エクスポート
6. **投稿**: WordPress手動インポート → スケジュール公開

## 6. 運用要件

### 6.1 スケジュール投稿機能 ✅
- **間隔**: 1時間ごとの自動公開
- **設定方法**: WordPress XML内でfutureステータス指定
- **開始時刻**: 指定可能（デフォルト：現在時刻+1時間）
- **記事数**: 一括10記事対応

### 6.2 記事品質管理 ✅
- **文字数**: 2000-3000文字
- **SEO対策**: タイトル、メタディスクリプション最適化
- **内容品質**: Claude AIによる自然で読みやすい文章
- **アフィリエイト**: 記事内容に自然に組み込まれたリンク

### 6.3 メンテナンス ✅
- **ログ監視**: 詳細な処理ログとエラーログ
- **API制限**: レート制限の考慮と適切な間隔制御
- **データバックアップ**: 生成記事のJSON保存

## 7. 制約事項

### 7.1 技術的制約 ✅
- Python 3.12.3 + WSL2環境での動作
- 外部API依存（Claude、楽天、Unsplash）
- WordPress XMLインポート方式による投稿

### 7.2 運用制約 ✅
- 記事投稿は手動インポート方式
- API使用量制限に依存
- インターネット接続必須

### 7.3 コスト制約 ✅
- Claude API使用料
- 楽天API無料枠内での運用
- Unsplash無料枠内での運用

## 8. 成功基準

### 8.1 機能面 ✅ 達成
- [x] 高品質な記事の自動生成
- [x] 楽天アフィリエイトリンクの適切な挿入
- [x] WordPress記事の正常な投稿
- [x] スケジュール投稿の正常動作
- [x] アイキャッチ画像の自動設定

### 8.2 品質面 ✅ 達成
- [x] 生成記事のSEO最適化
- [x] 自然で読みやすい文章品質
- [x] エラーハンドリングの適切な実装
- [x] ユーザーフレンドリーなUI

### 8.3 運用面 ✅ 達成
- [x] 一括記事生成機能（10記事対応）
- [x] スケジュール投稿機能（1時間間隔）
- [x] 安定した長時間運用
- [x] 適切なログ出力と監視

## 9. 今後の拡張予定

### 9.1 機能拡張
- [ ] REST API直接投稿への対応
- [ ] 記事の自動更新機能
- [ ] より多様なアフィリエイトプログラム対応
- [ ] 記事のA/Bテスト機能

### 9.2 技術改善
- [ ] Docker対応
- [ ] CI/CDパイプライン構築
- [ ] 自動テスト拡充
- [ ] パフォーマンス最適化

## 10. 変更履歴

| バージョン | 日付 | 変更内容 | 担当者 |
|-----------|------|---------|-------|
| 1.0 | 2025年6月9日 | 初版作成、基本機能定義 | Claude Code |
| 2.0 | 2025年6月10日 | 完成版、全機能実装完了、スケジュール投稿対応、XML形式対応 | Claude Code |

---

**承認者**: aime  
**プロジェクトステータス**: ✅ 完了  
**次フェーズ**: 運用開始・機能拡張検討